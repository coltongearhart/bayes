# HW - Single Parameter Inference

```{r}
#| label: load-prereqs
#| echo: false
#| message: false

# knitr options
source("_common.R")

```

PICTURES AND RELOCATE

<!-- <embed src="assignments/hw-single-parameter-inference.pdf" type="application/pdf" width="100%" height="500px"></embed> -->

## Problem 1 

*Thirty randomly selected Chase customers in Cincinnati were interviewed about their experiences with Chase financial investment advising service back in 2016 and they reported the average waiting time (unit: days) until the first meeting with a financial advisor in their local branch (given below). Julia, the Chase marketing manager believes that these waiting times can be reasonably modeled with an exponential distribution, i.e., $Y_1, \ldots, Y_{30} \overset{iid}\sim \text{Exp}(\lambda)$, or $f(y_i \mid \lambda) = \lambda\mathrm{e}^{-\lambda y_i}$, where $i = 1, \ldots, 30$.*

```{r}

y <- c(4.3,1.0,0.5,5.2,2.5,1.6,1.3,2.5,1.2,2.3,0.8,14.4,1.7,0.5,2.2,
        4.5,2.7,1.2,5.5,2.6,0.2,0.6,2.1,0.6,1.9,3.8,1.1,5.2,2.1,2.0)

```

### Part a -- Prior distribution

*Julia considered a Bayesian analysis. From the historical data, on average the bank customers waited 2.5 days until their first meeting with the bank financial advisor. She assumed that the prior variance is 0.2. Please use this information to obtain an informative prior distribution for $\lambda$.*

### Part b -- Posterior distribution

*Use the prior in (a), find the posterior distribution for $\lambda$*.

```{r}

# needed calculation for posterior gamma(alpha, beta)
# -> beta-post = beta-prior + sum(y)
12.5 + sum(y)

```

## Problem 2 

*Progesterone level is monitored for 30 randomly chosen pregnant sheep with singletons that are 80 days pregnant.*

```{r}

y <- c(3.8,5.0,4.5,4.2,5.5,5.8,4.6,5.3,7.2,5.7,6.0,6.3,4.8,5.6,4.9,
       4.3,4.9,4.2,3.4,4.8,5.2,5.9,5.7,2.8,6.6,6.1,9.3,7.7,5.3,7.8)

```

*Jeff would like to model these measurements as normal responses from the same normal population, $\text{N}(\mu,1.52)$. He also found out in literature that, for 80-days pregnant sheep with singletons, the average progesterone level should be centered around 8, and the range of such measurements is between 4 and 12.*

### Part a -- Prior distribution

*Please suggest a prior distribution of μ for Jeff based on the literature information.*

### Part b -- Posterior distribution

*Specify the posterior distribution parameters of $\mu$*.

```{r}

# specify parameters, hyperparameters and other needed constants
sigma <- 1.5
mu_0 <- 8
tau_0 <- 4/3
n <- length(y)

# calculate posterior parameters
(tau2_n <- (n / sigma^2 + 1 / tau_0^2)^(-1))
(mu_n <- tau2_n * (sum(y) / sigma^2 + mu_0 / tau_0^2))

```

### Part c -- Monte Carlo probability

*Use the Monte Carlo approach to calculate $P(\mu > 5 \mid \mathbf{y})$.*

```{r}

# generate sample from posterior distribution
# -> mu | y-vec ~ Normal(mu_n, tau^2_n)
data_post_sample <- rnorm(n = 10000, mean = mu_n, sd = sqrt(tau2_n))
head(data_post_sample, n = 5)

# calculate Monte Carlo probability
# -> P(mu > 5 | y-vec)
(prob <- mean(data_post_sample > 5))

```

Using Monte Carlo methods, our estimate of $P(\mu > 5 \mid \mathbf{y}) \approx$ 
`{r} round(prob, 3)`

### Part d -- Posterior predictive distribution

*A new sheep will be selected at random from the same population of interest. Simulate the posterior predictive distribution of the progesterone level of this new sheep. Report the estimated mean and standard deviation of the progesterone level for this new sheep based on the posterior predictive distribution you obtain.*

Simulation approach

```{r}

# simulate posterior predictive distribution

# simulate mu's from posterior mu | y-vec
M <- 10000000
mu_m <- rnorm(n = M, mean = mu_n, sd = sqrt(tau2_n))
head(mu_m)

# simulate new observations from data distribution using newly sampled mu's
y_new <- rnorm(n = M, mean = mu_m, sd = sigma)
head(y_new)

# approximate mean and standard deviation of posterior predictive distribution
mean(y_new) # MATCHES THEORY
sd(y_new) # DOESN'T MATCH THEORY :(

```

Verify with known theoretical results

```{r}



```

## Problem 3 

Jill is the data analyst at the Tristate Phoenix clinic, she randomly selected records of the BMI from female patients in the clinic (denoted by $X_1, \ldots, X_{32}$) and male patients (denoted by $Y_1, \ldots, Y_{28}$), and she assumed these two sets of records were independent normally distributed with means $\mu_X, \mu_Y$ , and variances $\sigma^2_X = \sigma^2_Y = 1$. Could you help her calculate a 95% credible interval (equal tails) for $\mu_X − \mu_Y$, using the following priors $\mu_X \sim \text{N}(\mu = 22, \sigma^24),\, \mu_Y \sim \text{N}(\mu = 20.5, \sigma^2 = 4)$ on $\mu_X, \mu_Y$?

```{r}

x = c(22.7,21.5,23.1,21.7,23.2,22.4,20.3,23.7,23.2,22.3,24.3,
      22.3,22.9,22.1,22.3,21.2,23.5,21.5,21.6,20.9,20.0,20.0,
      21.1,24.1,22.6,22.2,21.3,20.8,22.0,22.9,23.2,20.5)

y = c(22.0,20.3,20.6,20.4,20.5,20.0,18.9,20.2,21.4,21.4,18.5,20.8,22.8,19.1,
      18.8,19.7,21.0,20.2,21.3,20.5,19.2,20.6,20.1,18.9,20.9,19.6,21.3,21.4)

```

## Problem 4 

*Suppose $Y \mid \theta \sim \text{Poisson}(\theta)$. Find the Jeffrey’s prior for $\theta$.*